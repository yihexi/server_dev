### HTTP1的问题

* 编码效率低

    HTTP1协议都是文本格式，压缩效率低或者没有压缩。HTTP头部和Cookie每次请求都会发送，甚至可能超过负载数据，效率极其低下。

* TCP连接复用率低

    如果使用多路复用方案，有TCP慢启动问题，且开发难度大。另外，浏览器限制一个域名的连接数，而页面的元素远远超过这个限制。数据传输中状态下协议不支持终止请求，只能断开连接，重新建立TCP连接耗时开销大。

* 没有请求优先级

    没有优先级，比如网页上的不重要部分和重要的部分无法区分。只能在TCP层实现，成本高。

* 不支持服务器推送

    服务端无法主动发送消息给客户端（需要自己在HTTP协议上自己实现）



### HTTP2如何解决

**TCP连接复用率低**

通过frame方式发送数据，一个TCP连接可以传输多个Stream，实现多路复用。Stream支持reset，终止请求。

**没有请求优先级**

Stream有优先级设置和依赖关系。

**编码效率低**

HPACK头部编码只传输变化头部，大大减少传输数据。

**不支持服务器推送**

因为是Stream，HTTP2语义可以支持服务器推送（但请求仍然需要客户端发起，只是在长连接上推送）



### HTTP2问题

* 队头阻塞

    TCP层面要保持报文有序。而多个Stream实际逻辑上没有依赖关系。一个包失败导致多个包重传。

* 两次握手

    传输层握手和TLS握手。



### HTTPS需要几个RTT？

发起正式请求之前，TLS1.2需要3个RTT：

```
TCP 握手
TLS SayHello
TLS 加密
```

如果复用底层TCP连接，也需要2个RTT。

TLS1.3需要2个RTT，复用底层连接需要一个RTT。









